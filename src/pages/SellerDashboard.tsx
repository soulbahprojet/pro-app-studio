import React, { useState, useEffect } from 'react';
import { useAuth } from '@/contexts/AuthContext';
import { supabase } from '@/integrations/supabase/client';
import { SidebarProvider, SidebarTrigger } from '../ui/sidebar';
import { AppSidebar } from '
            param($matches)
            $componentPath = $matches[1].Replace('/', '\')
            $absolutePath = Join-Path -Path $PWD -ChildPath "src\components\$componentPath"
            $relativePath = [IO.Path]::GetRelativePath($dir, $absolutePath) -replace '\\','/'
            return $relativePath
        
import Breadcrumb from '
            param($matches)
            $componentPath = $matches[1].Replace('/', '\')
            $absolutePath = Join-Path -Path $PWD -ChildPath "src\components\$componentPath"
            $relativePath = [IO.Path]::GetRelativePath($dir, $absolutePath) -replace '\\','/'
            return $relativePath
        
import VendorTrackingDashboard from '
            param($matches)
            $componentPath = $matches[1].Replace('/', '\')
            $absolutePath = Join-Path -Path $PWD -ChildPath "src\components\$componentPath"
            $relativePath = [IO.Path]::GetRelativePath($dir, $absolutePath) -replace '\\','/'
            return $relativePath
        
import FloatingHomeButton from '
            param($matches)
            $componentPath = $matches[1].Replace('/', '\')
            $absolutePath = Join-Path -Path $PWD -ChildPath "src\components\$componentPath"
            $relativePath = [IO.Path]::GetRelativePath($dir, $absolutePath) -replace '\\','/'
            return $relativePath
        
import ShopCustomization from '
            param($matches)
            $componentPath = $matches[1].Replace('/', '\')
            $absolutePath = Join-Path -Path $PWD -ChildPath "src\components\$componentPath"
            $relativePath = [IO.Path]::GetRelativePath($dir, $absolutePath) -replace '\\','/'
            return $relativePath
        
import OrderManagement from '
            param($matches)
            $componentPath = $matches[1].Replace('/', '\')
            $absolutePath = Join-Path -Path $PWD -ChildPath "src\components\$componentPath"
            $relativePath = [IO.Path]::GetRelativePath($dir, $absolutePath) -replace '\\','/'
            return $relativePath
        
import WalletManagement from '
            param($matches)
            $componentPath = $matches[1].Replace('/', '\')
            $absolutePath = Join-Path -Path $PWD -ChildPath "src\components\$componentPath"
            $relativePath = [IO.Path]::GetRelativePath($dir, $absolutePath) -replace '\\','/'
            return $relativePath
        
import WalletTransferSystem from '
            param($matches)
            $componentPath = $matches[1].Replace('/', '\')
            $absolutePath = Join-Path -Path $PWD -ChildPath "src\components\$componentPath"
            $relativePath = [IO.Path]::GetRelativePath($dir, $absolutePath) -replace '\\','/'
            return $relativePath
        
import ChatSystem from '
            param($matches)
            $componentPath = $matches[1].Replace('/', '\')
            $absolutePath = Join-Path -Path $PWD -ChildPath "src\components\$componentPath"
            $relativePath = [IO.Path]::GetRelativePath($dir, $absolutePath) -replace '\\','/'
            return $relativePath
        
import SellerMessaging from '
            param($matches)
            $componentPath = $matches[1].Replace('/', '\')
            $absolutePath = Join-Path -Path $PWD -ChildPath "src\components\$componentPath"
            $relativePath = [IO.Path]::GetRelativePath($dir, $absolutePath) -replace '\\','/'
            return $relativePath
        
import AnalyticsDashboard from '
            param($matches)
            $componentPath = $matches[1].Replace('/', '\')
            $absolutePath = Join-Path -Path $PWD -ChildPath "src\components\$componentPath"
            $relativePath = [IO.Path]::GetRelativePath($dir, $absolutePath) -replace '\\','/'
            return $relativePath
        
import ReviewsManagement from '
            param($matches)
            $componentPath = $matches[1].Replace('/', '\')
            $absolutePath = Join-Path -Path $PWD -ChildPath "src\components\$componentPath"
            $relativePath = [IO.Path]::GetRelativePath($dir, $absolutePath) -replace '\\','/'
            return $relativePath
        
import PaymentMethodSelector from '
            param($matches)
            $componentPath = $matches[1].Replace('/', '\')
            $absolutePath = Join-Path -Path $PWD -ChildPath "src\components\$componentPath"
            $relativePath = [IO.Path]::GetRelativePath($dir, $absolutePath) -replace '\\','/'
            return $relativePath
        
import ProformaInvoiceManager from '
            param($matches)
            $componentPath = $matches[1].Replace('/', '\')
            $absolutePath = Join-Path -Path $PWD -ChildPath "src\components\$componentPath"
            $relativePath = [IO.Path]::GetRelativePath($dir, $absolutePath) -replace '\\','/'
            return $relativePath
        
import { ManualInvoiceManager } from '
            param($matches)
            $componentPath = $matches[1].Replace('/', '\')
            $absolutePath = Join-Path -Path $PWD -ChildPath "src\components\$componentPath"
            $relativePath = [IO.Path]::GetRelativePath($dir, $absolutePath) -replace '\\','/'
            return $relativePath
        
import PaymentEscrowDashboard from '
            param($matches)
            $componentPath = $matches[1].Replace('/', '\')
            $absolutePath = Join-Path -Path $PWD -ChildPath "src\components\$componentPath"
            $relativePath = [IO.Path]::GetRelativePath($dir, $absolutePath) -replace '\\','/'
            return $relativePath
        
import Header from '
            param($matches)
            $componentPath = $matches[1].Replace('/', '\')
            $absolutePath = Join-Path -Path $PWD -ChildPath "src\components\$componentPath"
            $relativePath = [IO.Path]::GetRelativePath($dir, $absolutePath) -replace '\\','/'
            return $relativePath
        
import { Card, CardContent, CardHeader, CardTitle } from '../ui/card';
import { Button } from '../ui/button';
import { Input } from '../ui/input';
import { Badge } from '../ui/badge';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '../ui/tabs';
import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '../ui/dialog';
import { Label } from '../ui/label';
import { Textarea } from '../ui/textarea';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '../ui/select';
import { Progress } from '../ui/progress';
import { Alert, AlertDescription } from '../ui/alert';
import { useToast } from '@/hooks/use-toast';
import {
  Package,
  Users,
  TrendingUp,
  ShoppingCart,
  Plus,
  Edit,
  Trash2,
  Eye,
  UserPlus,
  DollarSign,
  Upload,
  Download,
  QrCode,
  Wallet,
  BarChart3,
  Settings,
  Globe,
  MapPin,
  FileDigit,
  CreditCard,
  Truck,
  Star,
  Calendar,
  Menu,
  Store,
  Video,
  Image as ImageIcon,
  EyeOff,
  MessageCircle,
  Phone,
  Mic,
  Send,
  Shield,
  X
} from 'lucide-react';

interface Product {
  id: string;
  name: string;
  description: string;
  price: number;
  currency: string;
  stock_quantity: number;
  category: string;
  type: 'physical' | 'digital';
  is_active: boolean;
  images: string[];
  video_url?: string;
  download_limit?: number;
  digital_file_url?: string;
  is_featured: boolean;
  featured_until?: string;
  sort_order: number;
  created_at: string;
}

interface Stats {
  summary: {
    totalProducts: number;
    totalOrders: number;
    totalRevenue: number;
    totalAffiliateEarnings: number;
    averageRating: number;
    totalReviews: number;
    conversionRate: string;
  };
  wallet: {
    balance_gnf: number;
    balance_usd: number;
    balance_eur: number;
    balance_xof: number;
    balance_cny: number;
    is_frozen?: boolean;
  };
}

const SellerDashboard = () => {
  const { user } = useAuth();
  const { toast } = useToast();
  
  const [loading, setLoading] = useState(true);
  const [products, setProducts] = useState<Product[]>([]);
  const [stats, setStats] = useState<Stats | null>(null);
  const [profile, setProfile] = useState<any>(null);
  const [showProductDialog, setShowProductDialog] = useState(false);
  const [showPaymentDialog, setShowPaymentDialog] = useState(false);
  const [selectedPaymentPlan, setSelectedPaymentPlan] = useState<string>('');

  const [newProduct, setNewProduct] = useState({
    name: '',
    description: '',
    price: '',
    currency: 'GNF',
    stock_quantity: '',
    category: '',
    type: 'physical' as 'physical' | 'digital',
    download_limit: '',
    video_url: ''
  });

  useEffect(() => {
    if (user) {
      loadData();
    }
  }, [user]);

  const loadData = async () => {
    if (!user) return;

    try {
      setLoading(true);
      
      // Charger le profil
      const { data: profileData } = await supabase
        .from('profiles')
        .select('*')
        .eq('user_id', user.id)
        .single();
      
      if (profileData) {
        setProfile(profileData);
      }

      // Charger les produits
      const { data: productsData } = await supabase
        .from('products')
        .select('*')
        .eq('seller_id', user.id)
        .order('sort_order', { ascending: false });
      
      if (productsData) {
        setProducts(productsData);
      }

      // Charger les statistiques
      const { data: statsData, error: statsError } = await supabase.functions.invoke('stats', {
        body: { seller_id: user.id }
      });

      console.log('Stats response:', { statsData, statsError });
      console.log('Wallet data from stats:', statsData?.wallet);

      if (statsData) {
        setStats(statsData);
      }
      
    } catch (error) {
      console.error('Error loading data:', error);
      toast({
        title: "Erreur",
        description: "Impossible de charger les données",
        variant: "destructive"
      });
    } finally {
      setLoading(false);
    }
  };

  const handleAddProduct = async () => {
    if (!newProduct.name || !newProduct.description || !newProduct.price || !newProduct.category) {
      toast({
        title: "Erreur",
        description: "Veuillez remplir tous les champs requis",
        variant: "destructive"
      });
      return;
    }

    try {
      const productData = {
        ...newProduct,
        price: parseFloat(newProduct.price),
        stock_quantity: newProduct.type === 'physical' ? parseInt(newProduct.stock_quantity || '0') : 0,
        download_limit: newProduct.type === 'digital' ? parseInt(newProduct.download_limit || '0') : null,
      };

      const { data, error } = await supabase.functions.invoke('products', {
        body: productData
      });

      if (error) throw error;

      setProducts([data.product, ...products]);
      setNewProduct({
        name: '',
        description: '',
        price: '',
        currency: 'GNF',
        stock_quantity: '',
        category: '',
        type: 'physical',
        download_limit: '',
        video_url: ''
      });
      setShowProductDialog(false);
      
      toast({
        title: "Succès",
        description: "Produit ajouté avec succès"
      });
    } catch (error) {
      console.error('Error adding product:', error);
      toast({
        title: "Erreur",
        description: "Impossible d'ajouter le produit",
        variant: "destructive"
      });
    }
  };

  const handlePaymentSuccess = () => {
    loadData();
    toast({
      title: "Succès",
      description: "Votre abonnement a été mis à jour avec succès!",
    });
  };

  const formatAmount = (amount: number, currency: string) => {
    if (currency === 'GNF') {
      return `${amount.toLocaleString()} GNF`;
    }
    return new Intl.NumberFormat('fr-FR', {
      style: 'currency',
      currency: currency,
      minimumFractionDigits: 2
    }).format(amount);
  };

  if (loading) {
    return (
      <div className="min-h-screen bg-background">
        <Header />
        <SidebarProvider>
          <div className="min-h-screen flex w-full pt-20">
            <AppSidebar />
            <main className="flex-1 flex items-center justify-center">
              <div className="text-center">
                <div className="animate-spin rounded-full h-32 w-32 border-b-2 border-primary"></div>
                <p className="mt-4 text-lg">Chargement des données...</p>
              </div>
            </main>
          </div>
        </SidebarProvider>
      </div>
    );
  }

  if (!user) {
    return (
      <div className="min-h-screen bg-background">
        <Header />
        <SidebarProvider>
          <div className="min-h-screen flex w-full pt-20">
            <AppSidebar />
            <main className="flex-1 flex items-center justify-center">
              <div className="text-center">
                <h2 className="text-2xl font-bold mb-4">Accès restreint</h2>
                <p>Vous devez être connecté pour accéder au tableau de bord marchand.</p>
              </div>
            </main>
          </div>
        </SidebarProvider>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-background">
      <Header />
      <SidebarProvider>
        <div className="min-h-screen flex w-full bg-background pt-20">
          <AppSidebar />
          <div className="flex-1 flex flex-col min-w-0">
            {/* Header fixe avec une hauteur définie */}
            <header className="sticky top-0 z-10 h-14 flex items-center border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 px-4">
              <SidebarTrigger />
              <div className="flex-1 flex items-center justify-between ml-4">
                <h1 className="font-semibold truncate">Dashboard Marchand - Plateforme Complète</h1>
                {profile?.subscription_plan && (
                  <Badge className="ml-2 bg-gradient-to-r from-yellow-400 to-orange-500 text-xs">
                    {profile.subscription_plan.toUpperCase()}
                  </Badge>
                )}
              </div>
            </header>
            
            {/* Contenu principal avec scroll indépendant */}
            <main className="flex-1 overflow-auto">
              <div className="container mx-auto px-4 py-6 space-y-6">
                <Breadcrumb 
                  items={[
                    { label: 'Accueil', href: '/' },
                    { label: 'Dashboard Marchand', href: '/seller-dashboard' }
                  ]} 
                />

                {/* Métriques de résumé */}
                {stats && (
                  <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                    <Card>
                      <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
                        <CardTitle className="text-sm font-medium">Total Produits</CardTitle>
                        <Package className="h-4 w-4 text-muted-foreground" />
                      </CardHeader>
                      <CardContent>
                        <div className="text-2xl font-bold">{stats.summary.totalProducts}</div>
                        <p className="text-xs text-muted-foreground">
                          {products.filter(p => p.is_featured).length} mis en avant
                        </p>
                      </CardContent>
                    </Card>

                    <Card>
                      <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
                        <CardTitle className="text-sm font-medium">Commandes</CardTitle>
                        <ShoppingCart className="h-4 w-4 text-muted-foreground" />
                      </CardHeader>
                      <CardContent>
                        <div className="text-2xl font-bold">{stats.summary.totalOrders}</div>
                        <p className="text-xs text-muted-foreground">
                          Ce mois-ci
                        </p>
                      </CardContent>
                    </Card>

                    <Card>
                      <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
                        <CardTitle className="text-sm font-medium">Revenus</CardTitle>
                        <TrendingUp className="h-4 w-4 text-muted-foreground" />
                      </CardHeader>
                      <CardContent>
                        <div className="text-2xl font-bold">{formatAmount(stats.summary.totalRevenue, 'GNF')}</div>
                        <p className="text-xs text-muted-foreground">
                          Total généré
                        </p>
                      </CardContent>
                    </Card>

                    <Card>
                      <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
                        <CardTitle className="text-sm font-medium">Portefeuille</CardTitle>
                        <Wallet className="h-4 w-4 text-muted-foreground" />
                      </CardHeader>
                      <CardContent>
                        <div className="text-2xl font-bold">{(stats?.wallet?.balance_gnf || 0).toLocaleString()} GNF</div>
                        <p className="text-xs text-muted-foreground">
                          Solde disponible
                        </p>
                      </CardContent>
                    </Card>
                  </div>
                )}

                {/* Interface avec onglets */}
                <Tabs defaultValue="overview" className="space-y-6">
                  <TabsList className="grid w-full grid-cols-8">
                    <TabsTrigger value="overview">Vue d'ensemble</TabsTrigger>
                    <TabsTrigger value="products">Produits</TabsTrigger>
                    <TabsTrigger value="orders">Commandes</TabsTrigger>
                    <TabsTrigger value="analytics">Analytics</TabsTrigger>
                    <TabsTrigger value="shop">Boutique</TabsTrigger>
                    <TabsTrigger value="messaging">Messages</TabsTrigger>
                    <TabsTrigger value="wallet">Portefeuille</TabsTrigger>
                    <TabsTrigger value="settings">Paramètres</TabsTrigger>
                  </TabsList>

                  <TabsContent value="overview" className="space-y-6">
                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                      <Card>
                        <CardHeader>
                          <CardTitle>Analytics</CardTitle>
                        </CardHeader>
                        <CardContent>
                          <AnalyticsDashboard stats={stats ? {
                            ...stats,
                            ordersByStatus: {},
                            topProducts: [],
                            reviews: { average: 4.5, total: 0, distribution: {}, recent: [] },
                            revenue: { daily: [], monthly: [] }
                          } : null} />
                        </CardContent>
                      </Card>
                    </div>
                  </TabsContent>

                  <TabsContent value="products" className="space-y-6">
                    <div className="flex justify-between items-center">
                      <div>
                        <h2 className="text-2xl font-bold">Gestion des Produits</h2>
                        <p className="text-muted-foreground">Gérez votre catalogue de produits</p>
                      </div>
                      <Dialog open={showProductDialog} onOpenChange={setShowProductDialog}>
                        <DialogTrigger asChild>
                          <Button>
                            <Plus className="w-4 h-4 mr-2" />
                            Ajouter un produit
                          </Button>
                        </DialogTrigger>
                        <DialogContent className="max-w-2xl">
                          <DialogHeader>
                            <DialogTitle>Ajouter un nouveau produit</DialogTitle>
                          </DialogHeader>
                          <div className="space-y-4">
                            <div className="grid grid-cols-2 gap-4">
                              <div>
                                <Label htmlFor="product-name">Nom du produit</Label>
                                <Input
                                  id="product-name"
                                  value={newProduct.name}
                                  onChange={(e) => setNewProduct({...newProduct, name: e.target.value})}
                                  placeholder="Nom du produit"
                                />
                              </div>
                              <div>
                                <Label htmlFor="product-category">Catégorie</Label>
                                <Select
                                  value={newProduct.category}
                                  onValueChange={(value) => setNewProduct({...newProduct, category: value})}
                                >
                                  <SelectTrigger>
                                    <SelectValue placeholder="Sélectionner une catégorie" />
                                  </SelectTrigger>
                                  <SelectContent>
                                    <SelectItem value="electronics">Électronique</SelectItem>
                                    <SelectItem value="clothing">Vêtements</SelectItem>
                                    <SelectItem value="books">Livres</SelectItem>
                                    <SelectItem value="home">Maison</SelectItem>
                                    <SelectItem value="beauty">Beauté</SelectItem>
                                    <SelectItem value="sports">Sport</SelectItem>
                                  </SelectContent>
                                </Select>
                              </div>
                            </div>

                            <div>
                              <Label htmlFor="product-description">Description</Label>
                              <Textarea
                                id="product-description"
                                value={newProduct.description}
                                onChange={(e) => setNewProduct({...newProduct, description: e.target.value})}
                                placeholder="Description du produit"
                                rows={3}
                              />
                            </div>

                            <div className="grid grid-cols-3 gap-4">
                              <div>
                                <Label htmlFor="product-price">Prix</Label>
                                <Input
                                  id="product-price"
                                  type="number"
                                  value={newProduct.price}
                                  onChange={(e) => setNewProduct({...newProduct, price: e.target.value})}
                                  placeholder="0"
                                />
                              </div>
                              <div>
                                <Label htmlFor="product-currency">Devise</Label>
                                <Select
                                  value={newProduct.currency}
                                  onValueChange={(value) => setNewProduct({...newProduct, currency: value})}
                                >
                                  <SelectTrigger>
                                    <SelectValue />
                                  </SelectTrigger>
                                  <SelectContent>
                                    <SelectItem value="GNF">GNF</SelectItem>
                                    <SelectItem value="USD">USD</SelectItem>
                                    <SelectItem value="EUR">EUR</SelectItem>
                                  </SelectContent>
                                </Select>
                              </div>
                              <div>
                                <Label htmlFor="product-stock">Stock</Label>
                                <Input
                                  id="product-stock"
                                  type="number"
                                  value={newProduct.stock_quantity}
                                  onChange={(e) => setNewProduct({...newProduct, stock_quantity: e.target.value})}
                                  placeholder="0"
                                />
                              </div>
                            </div>

                            <div className="flex justify-end space-x-2">
                              <Button variant="outline" onClick={() => setShowProductDialog(false)}>
                                Annuler
                              </Button>
                              <Button onClick={handleAddProduct}>
                                Ajouter le produit
                              </Button>
                            </div>
                          </div>
                        </DialogContent>
                      </Dialog>
                    </div>

                    <div className="grid gap-4">
                      {products.map((product) => (
                        <Card key={product.id}>
                          <CardContent className="p-4">
                            <div className="flex justify-between items-start">
                              <div className="flex-1">
                                <div className="flex items-center gap-2 mb-2">
                                  <h3 className="font-semibold">{product.name}</h3>
                                  {product.is_featured && (
                                    <Badge variant="secondary">Mis en avant</Badge>
                                  )}
                                  {!product.is_active && (
                                    <Badge variant="outline">Inactif</Badge>
                                  )}
                                </div>
                                <p className="text-sm text-muted-foreground mb-2">{product.description}</p>
                                <div className="flex gap-4 text-sm">
                                  <span>Prix: {formatAmount(product.price, product.currency)}</span>
                                  <span>Stock: {product.stock_quantity}</span>
                                  <span>Catégorie: {product.category}</span>
                                </div>
                              </div>
                              <div className="flex gap-2">
                                <Button size="sm" variant="outline">
                                  <Eye className="w-4 h-4" />
                                </Button>
                                <Button size="sm" variant="outline">
                                  <Edit className="w-4 h-4" />
                                </Button>
                                <Button size="sm" variant="outline">
                                  <Trash2 className="w-4 h-4" />
                                </Button>
                              </div>
                            </div>
                          </CardContent>
                        </Card>
                      ))}
                    </div>
                  </TabsContent>

                  <TabsContent value="orders">
                    <OrderManagement userId={user?.id || ''} />
                  </TabsContent>

                  <TabsContent value="analytics">
                    <AnalyticsDashboard stats={stats ? {
                      ...stats,
                      ordersByStatus: {},
                      topProducts: [],
                      reviews: { average: 4.5, total: 0, distribution: {}, recent: [] },
                      revenue: { daily: [], monthly: [] }
                    } : null} />
                  </TabsContent>

                  <TabsContent value="shop">
                    <ShopCustomization 
                      userId={user?.id || ''}
                      products={products}
                      onProductUpdate={() => loadData()}
                    />
                  </TabsContent>

                  <TabsContent value="messaging" className="h-full">
                    <div className="h-full">
                      <SellerMessaging />
                    </div>
                  </TabsContent>

                  <TabsContent value="wallet">
                    <div className="space-y-6">
                      <WalletManagement />
                      <WalletTransferSystem 
                        currentUserId={user?.id || ''}
                        userWallets={(() => {
                          console.log('Creating userWallets, stats:', stats);
                          console.log('Wallet balances:', {
                            gnf: stats?.wallet?.balance_gnf,
                            usd: stats?.wallet?.balance_usd
                          });
                          return [
                            { id: 'wallet_1', currency: 'GNF' as const, balance: stats?.wallet?.balance_gnf || 0 },
                            { id: 'wallet_2', currency: 'USD' as const, balance: stats?.wallet?.balance_usd || 0 }
                          ];
                        })()}
                        onTransfer={(transfer) => {
                          toast({
                            title: "Transfert effectué",
                            description: `${transfer.amount} ${transfer.currency} transféré`
                          });
                        }}
                      />
                      <PaymentEscrowDashboard />
                    </div>
                  </TabsContent>

                  <TabsContent value="settings">
                    <div className="space-y-6">
                      <Card>
                        <CardHeader>
                          <CardTitle>Méthodes de paiement</CardTitle>
                        </CardHeader>
                        <CardContent>
                          <Button onClick={() => setShowPaymentDialog(true)}>
                            Configurer les paiements
                          </Button>
                        </CardContent>
                      </Card>
                    </div>
                  </TabsContent>
                </Tabs>

                {/* Dialog pour les paiements */}
                <Dialog open={showPaymentDialog} onOpenChange={setShowPaymentDialog}>
                  <DialogContent className="max-w-2xl">
                    <DialogHeader>
                      <DialogTitle>Changement d'abonnement</DialogTitle>
                    </DialogHeader>
                    <PaymentMethodSelector
                      selectedPlan={selectedPaymentPlan}
                      currentPlan={profile?.subscription_plan || 'basic'}
                      onClose={() => setShowPaymentDialog(false)}
                      onSuccess={handlePaymentSuccess}
                    />
                  </DialogContent>
                </Dialog>
              </div>
            </main>
          </div>
        </div>
      </SidebarProvider>
    </div>
  );
};

export default SellerDashboard;
